 <!DOCTYPE html>
 <html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="icon" type="image/x-icon" href="/src/assets/images/ml5w3s.ico">
  <title>Aula</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="/src/assets/css/base.css" type="text/css" rel="stylesheet" media="screen,projection"/>
 </head>
 <body>

  <div id="header-placeholder"></div>
  <main id="aula" itemscope itemtype="https://schema.org/Course" class="container"></main>
  <div id="footer-placeholder"></div>

  <script src="/src/assets/js/main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      loadComponent('header-placeholder', '/src/assets/js/ui/components/header.html');
      loadComponent('footer-placeholder', '/src/assets/js/ui/components/footer.html');
      loadLesson();
    });

    async function loadLesson() {
      const params = new URLSearchParams(window.location.search);
      const course = params.get('curso');
      const lesson = params.get('aula');

      if (!course || !lesson) {
        document.getElementById('aula').innerHTML = '<h1>Curso ou aula não especificados.</h1>';
        return;
      }

      try {
        const response = await fetch(`/vitrine-ml5/mlab5/controle/dados/${course}/${lesson}.json`);
        if (!response.ok) throw new Error('Aula não encontrada.');
        
        const lessonData = await response.json();
        renderLesson(lessonData);
      } catch (error) {
        console.error(error);
        document.getElementById('aula').innerHTML = `<h1>Erro ao carregar a aula: ${error.message}</h1>`;
      }
    }

    function renderLesson(data) {
      const main = document.getElementById("aula");
      document.title = data.name; // Update the page title

      // Banner principal
      const sectionBanner = document.createElement("section");
      sectionBanner.className = "container";
      sectionBanner.innerHTML = "
        <article class=\"item\">
          <picture itemprop=\"image\" itemscope itemtype=\"https://schema.org/ImageObject\">
            <source media=\"(min-width:1024px)\" srcset=\"${data.image.desktop}\" itemprop=\"contentUrl\">
            <source media=\"(min-width:600px)\" srcset=\"${data.image.tablet}\" itemprop=\"contentUrl\">
            <img src=\"${data.image.mobile}\" alt=\"${data.image.alt || ''}\" itemprop=\"contentUrl\">
          </picture>
          <h1 itemprop=\"name\">${data.name}</h1>
        </article>
      ";
      main.appendChild(sectionBanner);

      // Renderização dos artigos
      data.articles.forEach(article => {
        const section = document.createElement("section");
        section.className = "container";
        const art = document.createElement("article");
        art.className = "item";
        art.setAttribute("itemscope", "");
        art.setAttribute("itemtype", "https://schema.org/Article");
        art.setAttribute("itemprop", "hasPart");
        
        let content = `<meta itemprop=\"position\" content=\"" + article.position + "">`;
        if (article.headline) content += `<h2 itemprop=\"headline\">${article.headline}</h2>`;
        if (article.text) content += `<p itemprop=\"text\">${article.text}</p>`;
        if (article.alternativeHeadline) content += `<h3 itemprop=\"alternativeHeadline\">${article.alternativeHeadline}</h3>`;

        if (article.list) {
          content += '<ul class="left_list">';
          article.list.forEach(item => {
            content += `<li>${item}</li>`;
          });
          content += '</ul>';
        }

        if (article.code) {
          content += `<meta itemprop=\"programmingLanguage\" content=\"" + (article.programmingLanguage || 'HTML') + "">
                      <pre><code itemprop=\"text\">${escapeHtml(Array.isArray(article.code) ? article.code.join('\n') : article.code)}</code></pre>`;
        }

        if (article.image) {
          content += `<figure itemprop=\"image\" itemscope itemtype=\"https://schema.org/ImageObject\">
                        <img src=\"" + (article.image.src || article.image.mobile) + "\" alt=\"" + (article.image.alt || '') + "\" itemprop=\"contentUrl\">
                        ${article.image.caption ? `<figcaption itemprop=\"caption\">${article.image.caption}</figcaption>` : ""}
                      </figure>`;
        }
        
        if (article.url) {
          content += `<a href=\"" + article.url + "\" itemprop=\"url\" class=\"btn-large\">${article.label}</a>`;
        }

        art.innerHTML = content;
        section.appendChild(art);
        main.appendChild(section);
      });

      // Render exercise
      if(data.exercise) {
        const section = document.createElement("section");
        section.className = "container";
        const art = document.createElement("article");
        art.className = "item";
        art.id = "exercicio";
        let exerciseContent = `<h3>${data.exercise.headline}</h3><p>${data.exercise.text}</p><ul>`;
        data.exercise.steps.forEach(step => {
            exerciseContent += `<li>${step}</li>`;
        });
        exerciseContent += `</ul>`;
        art.innerHTML = exerciseContent;
        section.appendChild(art);
        main.appendChild(section);
      }
      
      // Render playground link
      if(data.playground) {
          const section = document.createElement("section");
          section.className = "container";
          section.innerHTML = `<article class=\"item\"><a href=\"" + data.playground.url + "\" class=\"btn-large waves-effect waves-light teal lighten-1\">${data.playground.label || 'Playground'}</a></article>`;
          main.appendChild(section);
      }
    }

    function escapeHtml(unsafe) {
      return unsafe
           .replace(/&/g, "&amp;")
           .replace(/</g, "&lt;")
           .replace(/>/g, "&gt;")
           .replace(/"/g, "&quot;")
           .replace(/'/g, "&#039;");
    }
  </script>
 </body>
</html>
