<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: repositories/CourseRepository.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: repositories/CourseRepository.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
import { apiService } from '../services/ApiService.js';
import { Course } from '../models/Course.js';
import { Lesson } from '../models/Lesson.js';
import { Debug } from '../helpers/Debug.js';

/**
 * CourseRepository - Singleton para gerenciar a lógica de negócios e a transformação de dados de cursos.
 *
 * Este repositório é responsável por consumir dados brutos do ApiService e transformá-los
 * em instâncias de modelos (Course, Lesson), aplicando a lógica de negócios necessária.
 */
class CourseRepository {
    constructor() {
        if (CourseRepository.instance) {
            return CourseRepository.instance;
        }
        CourseRepository.instance = this;
    }

    /**
     * Busca o índice de cursos e o transforma em um array de instâncias de Course.
     * @returns {Promise&lt;Course[]>} Uma promessa que resolve para um array de instâncias de Course.
     */
    async getCourseIndex() {
        Debug.log('CourseRepository', 'Buscando e transformando o índice de cursos...');
        try {
            const courseIndexData = await apiService.fetchCourseIndex();
            Debug.table('CourseRepository', 'Índice de Cursos (Raw)', courseIndexData);

            if (courseIndexData &amp;&amp; Array.isArray(courseIndexData)) {
                return courseIndexData.map(meta => new Course(meta.id, meta.title, meta.description, [], meta.image));
            }
            return [];

        } catch (error) {
            Debug.error('CourseRepository', 'Falha ao processar o índice de cursos:', error);
            return [];
        }
    }

    /**
     * Busca um curso específico pelo seu ID e o transforma em uma instância de Course com suas aulas.
     * @param {string} courseId O ID do curso a ser buscado.
     * @returns {Promise&lt;Course|null>}
     */
    async getCourseById(courseId) {
        Debug.log('CourseRepository', `Processando dados para o curso com ID: ${courseId}`);
        try {
            const { courseMeta, lessonsData } = await apiService.fetchCourseData(courseId);

            if (!courseMeta) {
                throw new Error(`Metadados do curso com id '${courseId}' não encontrados.`);
            }

            Debug.log('CourseRepository', `Dados das aulas para o curso '${courseId}' (Raw).`, lessonsData);

            const lessons = lessonsData.map((lessonWrapper, index) => {
                const lessonContent = lessonWrapper.course;
                const lessonId = String(index + 1).padStart(2, '0');
                const lessonTitle = lessonContent.name;
                const lessonType = lessonContent.playground ? 'playground' : 'default';

                return new Lesson(lessonId, lessonTitle, lessonWrapper, lessonType);
            });

            const course = new Course(courseMeta.id, courseMeta.title, courseMeta.description, lessons, courseMeta.image);
            Debug.log('CourseRepository', `Curso '${courseId}' montado com sucesso.`, course);
            return course;

        } catch (error) {
            Debug.error('CourseRepository', `Falha ao montar o curso '${courseId}':`, error);
            return null;
        }
    }

    /**
     * Busca uma aula específica pelo ID do curso e ID da aula.
     * @param {string} courseId O ID do curso ao qual a aula pertence.
     * @param {string} lessonId O ID da aula a ser buscada.
     * @returns {Promise&lt;Lesson|null>}
     */
    async getLessonById(courseId, lessonId) {
        Debug.log('CourseRepository', `Buscando aula ${lessonId} no curso ${courseId}...`);
        try {
            const course = await this.getCourseById(courseId);
            if (course &amp;&amp; course.lessons) {
                const lesson = course.lessons.find(l => l.id === lessonId);
                if (lesson) {
                    Debug.log('CourseRepository', `Aula ${lessonId} encontrada.`, lesson);
                } else {
                    throw new Error(`Aula com id '${lessonId}' não encontrada no curso '${courseId}'.`);
                }
                return lesson;
            }
            return null;
        } catch (error) {
            Debug.error('CourseRepository', `Erro ao buscar a aula ${lessonId}:`, error);
            return null;
        }
    }
}

// Exporta a instância única do repositório.
export const courseRepository = new CourseRepository();
 </code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ApiService.html">ApiService</a></li><li><a href="Course.html">Course</a></li><li><a href="CourseRepository.html">CourseRepository</a></li><li><a href="DebugView.html">DebugView</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="Lesson.html">Lesson</a></li><li><a href="PlaygroundComponent.html">PlaygroundComponent</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bannerConfig">bannerConfig</a></li><li><a href="global.html#capitalizeFirstLetter">capitalizeFirstLetter</a></li><li><a href="global.html#managePlaygroundButton">managePlaygroundButton</a></li><li><a href="global.html#renderHomeView">renderHomeView</a></li><li><a href="global.html#renderLessonCreatorView">renderLessonCreatorView</a></li><li><a href="global.html#renderPlaygroundView">renderPlaygroundView</a></li><li><a href="global.html#reverseString">reverseString</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
