<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/PlaygroundComponent.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/PlaygroundComponent.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * PlaygroundComponent - Componente para renderizar um ambiente de codificação interativo.
 */
export class PlaygroundComponent {
    /**
     * @param {HTMLElement} containerElement - O elemento HTML onde o playground será renderizado.
     * @param {Lesson} lesson - O objeto da aula contendo instruções, exercícios e configurações do playground.
     */
    constructor(containerElement, lesson) {
        if (!containerElement) {
            throw new Error("O elemento container para o PlaygroundComponent é obrigatório.");
        }
        if (!lesson || !lesson.content || !lesson.content.course) {
            throw new Error("O objeto 'lesson' com conteúdo de curso é obrigatório para o PlaygroundComponent.");
        }
        this.containerElement = containerElement;
        this.lessonContent = lesson.content.course; // Acessa o objeto 'course' dentro do content
        this.render();
        this.setInitialCode(); // Call before addEventListeners
        this.addEventListeners();
    }

    render() {
        const { articles: rawArticles, exercise, controls, playground } = this.lessonContent;
        const articles = Array.isArray(rawArticles) ? rawArticles : [];

        let articlesHtml = '';
        if (articles.length) {
            articles.forEach(article => {
                // Skip hidden articles and articles specifically for playground instructions
                if (article.hidden || article.forPlayground) {
                    return;
                }

                articlesHtml += `&lt;article>`;
                if (article.headline) articlesHtml += `&lt;h4>${article.headline}&lt;/h4>`;
                if (article.alternativeHeadline) articlesHtml += `&lt;h5>${article.alternativeHeadline}&lt;/h5>`;
                if (article.text) articlesHtml += `&lt;p>${article.text}&lt;/p>`;
                if (article.list) {
                    articlesHtml += `&lt;ul>`;
                    article.list.forEach(item => articlesHtml += `&lt;li>${item}&lt;/li>`);
                    articlesHtml += `&lt;/ul>`;
                }
                if (article.image) {
                    // Simplificado para desktop por enquanto
                    articlesHtml += `&lt;img src="${article.image.desktop || article.image.src}" alt="${article.image.caption || ''}">`;
                    if (article.image.caption) articlesHtml += `&lt;p class="caption">${article.image.caption}&lt;/p>`;
                }
                if (article.code) {
                    const codeText = Array.isArray(article.code) ? article.code.join('\n') : String(article.code);
                    articlesHtml += `&lt;pre>&lt;code class="language-${article.programmingLanguage || 'html'}">${codeText}&lt;/code>&lt;/pre>`;
                }
                articlesHtml += `&lt;/article>`;
            });
        }

        let exerciseHtml = '';
        if (exercise) {
            exerciseHtml += `&lt;section class="exercise">`;
            exerciseHtml += `&lt;h3>${exercise.headline}&lt;/h3>`;
            exerciseHtml += `&lt;p>${exercise.text}&lt;/p>`;
            if (exercise.steps) {
                exerciseHtml += `&lt;ol>`;
                exercise.steps.forEach(step => exerciseHtml += `&lt;li>${step}&lt;/li>`);
                exerciseHtml += `&lt;/ol>`;
            }
            exerciseHtml += `&lt;/section>`;
        }

        let controlsHtml = '';
        if (controls &amp;&amp; Array.isArray(controls.templates)) {
            controlsHtml += `&lt;div class="playground-controls">`;
            controlsHtml += `&lt;label for="template-select">Template:&lt;/label>`;
            controlsHtml += `&lt;select id="template-select">`;
            controls.templates.forEach(template => {
                const templateName = template.split('/').pop().replace('.html', '');
                controlsHtml += `&lt;option value="${template}">${templateName}&lt;/option>`;
            });
            controlsHtml += `&lt;/select>`;
            // Adicionar mais controles de estilo aqui no futuro
            controlsHtml += `&lt;/div>`;
        }

        // Use playground.headline and playground.instructions for the main playground instructions
        const playgroundHeadline = playground &amp;&amp; playground.headline ? `&lt;h3>${playground.headline}&lt;/h3>` : '';
        const playgroundInstructions = playground &amp;&amp; playground.instructions ? `&lt;p>${playground.instructions}&lt;/p>` : '';


        this.containerElement.innerHTML = `
            &lt;div class="playground-wrapper">
            &lt;section class="container">
                &lt;article class="item">
                &lt;picture>
                    &lt;source media="(min-width: 1024px)" srcset="/vitrine-ml5/mlab5/assets/images/banner_play_desktop.png">
                    &lt;source media="(min-width: 600px)" srcset="/vitrine-ml5/mlab5/assets/images/banner_play_tablet.png">
                    &lt;img src="/vitrine-ml5/mlab5/assets/images/banner_play_mobile.png" alt="Playground Banner" style="width:100%;">
                &lt;/picture>
                &lt;/article>
            &lt;/section>
                &lt;div class="playground-instructions">
                    ${playgroundHeadline}
                    ${playgroundInstructions}
                    &lt;section class="container">
                        &lt;article class="item">
                            &lt;h3 id="link_instrucoes" style="cursor:pointer">Instruções&lt;/h3>
                            &lt;div id="texto" style="display:none;">
                                &lt;p id="instrucoes">&lt;/p>
                            &lt;/div>
                        &lt;/article>
                    &lt;/section>
                &lt;/div>
                &lt;div class="playground-editor">
                    &lt;!-- controlsHtml removido daqui -->
                    &lt;h4>Seu Código:&lt;/h4>
                    &lt;textarea id="code-input" class="code-input" rows="15" cols="80">&lt;/textarea>
                    &lt;button id="run-code-button">Executar Código&lt;/button>
                    &lt;h4>Preview:&lt;/h4>
                    &lt;iframe id="code-output" class="code-output" sandbox="allow-scripts allow-same-origin">&lt;/iframe>
                &lt;/div>
            &lt;/div>
            &lt;section class="container">
                &lt;article class="item">
                    &lt;h3 id="link_ajustes" style="cursor:pointer">Ajustes&lt;/h3>
                    &lt;div id="ajustes" style="display:none;">&lt;/div>
                &lt;/article>
            &lt;/section>
        `;
    }

    setInitialCode() {
        const { articles } = this.lessonContent;
        const codeInput = this.containerElement.querySelector('#code-input');
        if (!codeInput) {
            console.error("Elemento #code-input não encontrado no PlaygroundComponent.");
            return;
        }

        // O code-input agora inicia vazio por padrão.

        // Popular instruções
        const instrucoesEl = this.containerElement.querySelector('#instrucoes');
        if (instrucoesEl) {
            let instructionsText = '';
            const instrArticle = Array.isArray(articles) ? articles.find(a => a.forPlayground &amp;&amp; (a.text || a.list)) : null;
            if (instrArticle) {
                if (instrArticle.text) instructionsText += instrArticle.text + '\n';
                if (instrArticle.list) instructionsText += instrArticle.list.map(i => `• ${i}`).join('\n');
            }
            const stored = localStorage.getItem('instrucoes');
            if (stored) {
                instructionsText += (instructionsText ? '\n\n' : '') + stored;
            }
            instrucoesEl.textContent = instructionsText.trim();
        }

        // Popular ajustes com os templates
        const ajustesDiv = this.containerElement.querySelector('#ajustes');
        if (ajustesDiv) {
            const templates = ['classico.html', 'dark_mode.html', 'moderno.html'];
            let templatesHtml = '&lt;h4>Templates&lt;/h4>';
            templates.forEach(template => {
                const templateName = template.replace('.html', '');
                templatesHtml += `
                    &lt;div>
                        &lt;input type="radio" id="${templateName}" name="template" value="/vitrine-ml5/mlab5/src//js/components/templates/${template}">
                        &lt;label for="${templateName}">${templateName}&lt;/label>
                    &lt;/div>
                `;
                console.log('Valor de template:', template);
                console.log('Valor de templateName:', templateName);

                const html = `&lt;input type="radio" id="${templateName}" name="template" value="/vitrine-ml5/mlab5/src//js/components/templates/${template}">`;
                console.log(html);
            });
            templatesHtml += '&lt;button id="apply-customization-button">Aplicar&lt;/button>';
            ajustesDiv.innerHTML = templatesHtml;

            let customOptionsHtml = '&lt;h4>Customização&lt;/h4>';
            customOptionsHtml += `
            &lt;div id="customization-options">    
                &lt;div>
                    &lt;label for="custom-font">Fonte Personalizada:&lt;/label>
                    &lt;select id="custom-font">
                        &lt;option value="'Times New Roman', serif">Times New Roman&lt;/option>
                        &lt;option value="'Courier New', monospace">Courier New&lt;/option>
                        &lt;option value="'Lucida Console', monospace">Lucida Console&lt;/option>
                    &lt;/select>
                &lt;/div>
                &lt;div>
                    &lt;label for="custom-background">Cor de Fundo Personalizada:&lt;/label>
                    &lt;input type="color" id="custom-background" value="#ffffff">
                &lt;/div>
                &lt;div>
                    &lt;label for="custom-foreground">Cor do Texto Personalizada:&lt;/label>
                    &lt;input type="color" id="custom-foreground" value="#000000">
                &lt;/div>
            &lt;/div>
            `;
            ajustesDiv.innerHTML += customOptionsHtml;

            // Set initial values for color pickers from lesson data
            if (this.lessonContent.controls &amp;&amp; this.lessonContent.controls.styles) {
                const { background, foreground } = this.lessonContent.controls.styles;
                const backgroundInput = this.containerElement.querySelector('#custom-background');
                const foregroundInput = this.containerElement.querySelector('#custom-foreground');

                if (backgroundInput &amp;&amp; background) {
                    backgroundInput.value = background;
                }
                if (foregroundInput &amp;&amp; foreground) {
                    foregroundInput.value = foreground;
                }
            }

            ajustesDiv.innerHTML += '&lt;button id="open-new-page-button">Abrir em nova página&lt;/button>';
        }
    }
 
    addEventListeners() {
        const runButton = this.containerElement.querySelector('#run-code-button');
        if (runButton) {
            runButton.addEventListener('click', () => this.runCode());
        }

        const openNewPageButton = this.containerElement.querySelector('#open-new-page-button');
        if (openNewPageButton) {
            openNewPageButton.addEventListener('click', () => this.openInNewPage());
        }

        const applyCustomizationButton = this.containerElement.querySelector('#apply-customization-button');
        if (applyCustomizationButton) {
            applyCustomizationButton.addEventListener('click', () => this.applyCustomization());
        }

        // Event listeners para seleção de fonte
        const fontRadios = this.containerElement.querySelectorAll('input[name="font"]');
        fontRadios.forEach(radio => {
            radio.addEventListener('change', () => this.applyCustomization());
        });

        // Event listeners para customização de fonte e background
        const customFontInput = this.containerElement.querySelector('#custom-font');
        if (customFontInput) {
            customFontInput.addEventListener('change', () => this.applyCustomization());
        }

        const customBackgroundInput = this.containerElement.querySelector('#custom-background');
        if (customBackgroundInput) {
            customBackgroundInput.addEventListener('input', () => this.applyCustomization());
        }

        const customForegroundInput = this.containerElement.querySelector('#custom-foreground');
        if (customForegroundInput) {
            customForegroundInput.addEventListener('input', () => this.applyCustomization());
        }

        // Toggle simples para instruções/ajustes
        const linkInstrucoes = this.containerElement.querySelector('#link_instrucoes');
        const texto = this.containerElement.querySelector('#texto');
        if (linkInstrucoes &amp;&amp; texto) {
            linkInstrucoes.addEventListener('click', () => {
                texto.style.display = texto.style.display === 'none' ? 'block' : 'none';
            });
        }
        const linkAjustes = this.containerElement.querySelector('#link_ajustes');
        const ajustes = this.containerElement.querySelector('#ajustes');
        if (linkAjustes &amp;&amp; ajustes) {
            linkAjustes.addEventListener('click', () => {
                ajustes.style.display = ajustes.style.display === 'none' ? 'block' : 'none';
            });
        }
    }

    runCode() {
        const code = this.containerElement.querySelector('#code-input').value;
        const outputFrame = this.containerElement.querySelector('#code-output');
        outputFrame.srcdoc = code;
    }

    async applyCustomization() {
        const selectedTemplateInput = this.containerElement.querySelector('input[name="template"]:checked');
        const selectedFontInput = this.containerElement.querySelector('input[name="font"]:checked');
        const customFontInput = this.containerElement.querySelector('#custom-font');
        const customBackgroundInput = this.containerElement.querySelector('#custom-background');
        const customForegroundInput = this.containerElement.querySelector('#custom-foreground');

        let style = '';
        if (selectedFontInput) {
            style += `font-family: ${selectedFontInput.value};`;
        }
        if (customFontInput &amp;&amp; customFontInput.value) {
            style += `font-family: ${customFontInput.value};`;
        }
        if (customBackgroundInput &amp;&amp; customBackgroundInput.value) {
            style += `background-color: ${customBackgroundInput.value};`;
        }
        if (customForegroundInput &amp;&amp; customForegroundInput.value) {
            style += `color: ${customForegroundInput.value};`;
        }

        let finalHtml = this.containerElement.querySelector('#code-input').value;

        if (selectedTemplateInput) {
            try {
                const response = await fetch(selectedTemplateInput.value);
                if (!response.ok) throw new Error(`Erro ao carregar template: ${selectedTemplateInput.value}`);
                let templateHtml = await response.text();
                finalHtml = templateHtml.replace('&lt;!-- CODE_PLACEHOLDER -->', finalHtml);
            } catch (error) {
                console.error("Erro ao aplicar template:", error);
                this.containerElement.querySelector('#code-output').srcdoc = `&lt;p style="color:red;">Erro ao carregar template: ${error.message}&lt;/p>`;
                return;
            }
        }

        const headEndTag = finalHtml.indexOf('&lt;/head>');
        if (headEndTag !== -1) {
            finalHtml = finalHtml.substring(0, headEndTag) + `&lt;style>body { ${style} }&lt;/style>` + finalHtml.substring(headEndTag);
        } else {
            finalHtml = `&lt;head>&lt;style>body { ${style} }&lt;/style>&lt;/head>` + finalHtml;
        }

        this.containerElement.querySelector('#code-output').srcdoc = finalHtml;
    }

    async openInNewPage() {
        // This method now correctly applies styles to the new page
        const code = this.containerElement.querySelector('#code-input').value;
        const selectedTemplateInput = this.containerElement.querySelector('input[name="template"]:checked');
        const selectedFontInput = this.containerElement.querySelector('input[name="font"]:checked');
        const customFontInput = this.containerElement.querySelector('#custom-font');
        const customBackgroundInput = this.containerElement.querySelector('#custom-background');
        const customForegroundInput = this.containerElement.querySelector('#custom-foreground');

        let style = '';
        if (selectedFontInput) {
            style += `font-family: ${selectedFontInput.value};`;
        }
        if (customFontInput &amp;&amp; customFontInput.value) {
            style += `font-family: ${customFontInput.value};`;
        }
        if (customBackgroundInput &amp;&amp; customBackgroundInput.value) {
            style += `background-color: ${customBackgroundInput.value};`;
        }
        if (customForegroundInput &amp;&amp; customForegroundInput.value) {
            style += `color: ${customForegroundInput.value};`;
        }

        let finalHtml = code;

        if (selectedTemplateInput) {
            try {
                const response = await fetch(selectedTemplateInput.value);
                if (!response.ok) throw new Error(`Erro ao carregar template: ${selectedTemplateInput.value}`);
                let templateHtml = await response.text();
                finalHtml = templateHtml.replace('&lt;!-- CODE_PLACEHOLDER -->', finalHtml);
            } catch (error) {
                console.error("Erro ao aplicar template:", error);
                finalHtml = `&lt;p style="color:red;">Erro ao carregar template: ${error.message}&lt;/p>`;
            }
        }

        const headEndTag = finalHtml.indexOf('&lt;/head>');
        if (headEndTag !== -1) {
            finalHtml = finalHtml.substring(0, headEndTag) + `&lt;style>body { ${style} }&lt;/style>` + finalHtml.substring(headEndTag);
        } else {
            finalHtml = `&lt;head>&lt;style>body { ${style} }&lt;/style>&lt;/head>` + finalHtml;
        }

        const newWindow = window.open();
        newWindow.document.write(finalHtml);
        newWindow.document.close();
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ApiService.html">ApiService</a></li><li><a href="Course.html">Course</a></li><li><a href="CourseRepository.html">CourseRepository</a></li><li><a href="DebugView.html">DebugView</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="Lesson.html">Lesson</a></li><li><a href="PlaygroundComponent.html">PlaygroundComponent</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bannerConfig">bannerConfig</a></li><li><a href="global.html#capitalizeFirstLetter">capitalizeFirstLetter</a></li><li><a href="global.html#managePlaygroundButton">managePlaygroundButton</a></li><li><a href="global.html#renderHomeView">renderHomeView</a></li><li><a href="global.html#renderLessonCreatorView">renderLessonCreatorView</a></li><li><a href="global.html#renderPlaygroundView">renderPlaygroundView</a></li><li><a href="global.html#reverseString">reverseString</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
